<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="JustExtraLight.Views.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:JustExtraLight"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:applicationModel="using:Windows.ApplicationModel"
      xmlns:storage="using:Windows.Storage"
      xmlns:viewmodels="using:JustExtraLight.ViewModels"
      d:DataContext="{d:DesignInstance Type=viewmodels:MainPageViewModel}"
      mc:Ignorable="d"
      Loaded="Page_Loaded">

    <Grid>

        <Grid.Resources>

            <DataTemplate x:Key="ImagesTemplate">

                <ItemContainer>

                    <Grid CornerRadius="5"
                          Height="200"
                          x:Name="AttachmentTemplateGrid"
                          Padding="5"
                          Width="200">

                        <Grid.Background>

                            <ImageBrush Stretch="UniformToFill" />

                        </Grid.Background>

                    </Grid>

                </ItemContainer>

            </DataTemplate>

            <Style BasedOn="{StaticResource AccentButtonStyle}"
                   x:Key="LocalButtonStyle"
                   TargetType="Button">

                <Setter Property="Height"
                        Value="50" />
                <Setter Property="HorizontalAlignment"
                        Value="Stretch" />

            </Style>

        </Grid.Resources>

        <Grid.RowDefinitions>

            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />

        </Grid.RowDefinitions>

        <TitleBar Background="{ThemeResource ControlFillColorDefaultBrush}"
                  Grid.Row="0"
                  Height="48"
                  x:Name="AppTitleBar"
                  Subtitle="BETA"
                  Title="Just eXtra Light">

            <TitleBar.IconSource>

                <ImageIconSource ImageSource="/Assets/Icons/TitleBarIco.ico" />

            </TitleBar.IconSource>

            <TitleBar.RightHeader>

                <Button Content="&#xE946;"
                        FontFamily="Segoe Fluent Icons">

                    <Button.Flyout>

                        <Flyout>

                            <Grid>

                                <Grid.ColumnDefinitions>

                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />

                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>

                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />

                                </Grid.RowDefinitions>

                                <Image Grid.Column="0"
                                       Grid.Row="0"
                                       Grid.RowSpan="2"
                                       Height="60"
                                       Margin="0,0,20,0"
                                       Width="60">

                                    <Image.Source>

                                        <BitmapImage DecodePixelHeight="60"
                                                     DecodePixelType="Logical"
                                                     DecodePixelWidth="60"
                                                     UriSource="/Assets/Icons/TitleBarIco.ico" />

                                    </Image.Source>

                                </Image>

                                <TextBlock Grid.Column="1"
                                           Grid.Row="0"
                                           Grid.RowSpan="2"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           VerticalAlignment="Center">
                                    
                                    <Run FontWeight="SemiBold"
                                         Text="{x:Bind applicationModel:AppInfo.Current.Package.Id.Version.Major}" />
                                    <Run FontWeight="SemiBold"
                                         Text="." />
                                    <Run FontWeight="SemiBold"
                                         Text="{x:Bind applicationModel:AppInfo.Current.Package.Id.Version.Minor}" />
                                    <Run FontWeight="SemiBold"
                                         Text="." />
                                    <Run FontWeight="SemiBold"
                                         Text="{x:Bind applicationModel:AppInfo.Current.Package.Id.Version.Build}" />
                                    
                                    <LineBreak />
                                    
                                    <Run x:Uid="AppMadeWith" />
                                    
                                    <Hyperlink NavigateUri="https://github.com/libjxl/libjxl">
                                        
                                        <Hyperlink.Inlines>
                                            
                                            <Run Text="libjxl" />
                                            
                                        </Hyperlink.Inlines>
                                        
                                    </Hyperlink>
                                    
                                    <Run FontSize="12"
                                         Text="(ver 0.11.1)" />

                                </TextBlock>

                            </Grid>

                        </Flyout>

                    </Button.Flyout>

                </Button>

            </TitleBar.RightHeader>

        </TitleBar>

        <Grid Grid.Row="1"
              MaxWidth="1500"
              Padding="36">

            <Grid.ColumnDefinitions>

                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />

            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>

                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />

            </Grid.RowDefinitions>

            <Expander Grid.Column="0"
                      Grid.ColumnSpan="4"
                      Grid.Row="0"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch"
                      Margin="0,0,0,8">

                <Expander.Content>

                    <TextBox Margin="16"
                             x:Name="ArgumentsTextBox"
                             Text="{Binding Arguments}"
                             x:Uid="ArgumentsTextBox" />

                </Expander.Content>

                <Expander.Header>

                    <StackPanel Orientation="Horizontal"
                                Padding="12">

                        <FontIcon FontSize="24"
                                  Glyph="&#xE756;"
                                  Margin="0,0,16,0" />

                        <TextBlock VerticalAlignment="Center">

                            <TextBlock.Inlines>

                                <Run x:Uid="ExpertsSection1" />
                                <LineBreak />
                                <Run FontSize="12"
                                     FontWeight="Light"
                                     x:Uid="ExpertsSection2" />

                            </TextBlock.Inlines>

                        </TextBlock>

                    </StackPanel>

                </Expander.Header>

            </Expander>

            <Button Command="{Binding FolderCommand}"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Grid.Row="2"
                    IsEnabled="{Binding EnableAddButtons}"
                    Margin="0,0,8,0"
                    x:Name="AddFolderButton"
                    Style="{StaticResource LocalButtonStyle}">

                <Button.Content>

                    <StackPanel Orientation="Horizontal">

                        <FontIcon Glyph="&#xE8B7;"
                                  Margin="0,0,8,0" />
                        <TextBlock x:Uid="AddFolderButton" />

                    </StackPanel>

                </Button.Content>

            </Button>

            <Button Command="{Binding ImagesCommand}"
                    Grid.Column="2"
                    Grid.ColumnSpan="2"
                    Grid.Row="2"
                    IsEnabled="{Binding EnableAddButtons}"
                    x:Name="AddImagesButton"
                    Style="{StaticResource LocalButtonStyle}">

                <Button.Content>

                    <StackPanel Orientation="Horizontal">

                        <FontIcon Glyph="&#xE8B9;"
                                  Margin="0,0,8,0" />
                        <TextBlock x:Uid="ChooseImages" />

                    </StackPanel>

                </Button.Content>

            </Button>

            <Button Command="{Binding ConvertImagesCommand}"
                    Grid.Column="0"
                    Grid.ColumnSpan="4"
                    Grid.Row="3"
                    Height="60"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding EnableConvertButton}"
                    Margin="0,8"
                    x:Name="ConvertButton">

                <Button.Content>

                    <StackPanel Orientation="Horizontal">

                        <FontIcon Glyph="&#xE895;"
                                  Margin="0,0,8,0" />
                        <TextBlock x:Uid="ConvertButton" />

                    </StackPanel>

                </Button.Content>

            </Button>

            <Button Command="{Binding SaveImagesCommand}"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    Grid.Row="4"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding EnableSaveButton}"
                    Margin="0,0,8,0"
                    x:Name="SaveImagesButton">

                <Button.Content>

                    <StackPanel Orientation="Horizontal">

                        <FontIcon Glyph="&#xE78C;"
                                  Margin="0,0,8,0" />
                        <TextBlock x:Uid="SaveImagesButton" />

                    </StackPanel>

                </Button.Content>

            </Button>

            <Button Command="{Binding ClearImagesCommand}"
                    Grid.Column="3"
                    Grid.ColumnSpan="1"
                    Grid.Row="4"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding EnableClearButton, Mode=OneWay}"
                    x:Name="ClearListButton">

                <Button.Content>

                    <StackPanel Orientation="Horizontal">

                        <FontIcon Glyph="&#xE894;"
                                  Margin="0,0,8,0" />
                        <TextBlock x:Uid="ClearListButton" />

                    </StackPanel>

                </Button.Content>

            </Button>

            <TextBlock Grid.Column="0"
                       Grid.ColumnSpan="4"
                       Grid.Row="5"
                       HorizontalAlignment="Center"
                       x:Name="DragAndDropText"
                       Style="{StaticResource TitleTextBlockStyle}"
                       TextAlignment="Center"
                       VerticalAlignment="Center"
                       x:Uid="DragAndDropInstructions" />

            <ProgressRing Canvas.ZIndex="1"
                          Grid.Column="4"
                          Grid.ColumnSpan="1"
                          Grid.Row="5"
                          HorizontalAlignment="Right"
                          IsActive="{Binding IsConversionInProgress}"
                          Margin="8"
                          x:Name="LoadingRing"
                          VerticalAlignment="Bottom" />

            <GridView AllowDrop="True"
                      Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}"
                      DragOver="{x:Bind mainPageViewModel.ImageItemsView_DragOver}"
                      Drop="{x:Bind mainPageViewModel.ImageItemsView_Drop}"
                      Grid.Column="0"
                      Grid.ColumnSpan="4"
                      Grid.Row="5"
                      ItemsSource="{Binding ImagesList, Mode=OneTime}"
                      Margin="0,8,0,0"
                      x:Name="ImageItemsView"
                      SelectionMode="None">

                <GridView.ItemTemplate>

                    <DataTemplate x:DataType="storage:StorageFile">

                        <Image Height="88"
                               Width="88">

                            <Image.Source>

                                <BitmapImage DecodePixelHeight="88"
                                             DecodePixelType="Logical"
                                             DecodePixelWidth="88"
                                             UriSource="{x:Bind Path}" />

                            </Image.Source>

                        </Image>

                    </DataTemplate>

                </GridView.ItemTemplate>

            </GridView>

        </Grid>

        <InfoBar Grid.Row="1"
                 IsOpen="{Binding EnableSaveButton}"
                 Message="{Binding InfobarMessage}"
                 Title="{Binding InfoBarTitle}"
                 Severity="{Binding Severity}"
                 VerticalAlignment="Bottom" />

    </Grid>

</Page>